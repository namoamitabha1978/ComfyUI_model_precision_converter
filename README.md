# 模型精度工具集

这是一组用于 ComfyUI 的模型精度处理节点，包含模型精度检测和精度转换功能，支持多种模型格式和精度类型。

## 节点列表

### 1. 模型精度检测工具
- **类别**：模型工具/精度检测
- **功能**：分析指定模型的参数精度分布，生成详细的精度检测报告

### 2. 模型精度转换与修复
- **类别**：模型工具/精度转换
- **功能**：将模型在不同精度类型间进行转换（如 bf16→fp8），支持量化操作和模型修复

## 安装方法
1. 将本文件夹复制到 ComfyUI 的 `custom_nodes` 目录下
2. 重启 ComfyUI 即可自动加载节点

## 使用指南

### 模型精度检测工具使用步骤
1. 在 ComfyUI 节点面板中找到 "模型工具/精度检测" 分类，添加 "模型精度检测工具" 节点
2. 点击 `model_path` 输入框右侧的文件选择按钮，浏览并选择需要检测的模型文件
   - 支持格式：.safetensors、.ckpt、.pt 等常见模型格式
3. 运行节点后，在 "检测结果" 输出端可查看：
   - 模型路径和总参数数量
   - 各精度类型（如 fp32、fp16、bf16 等）的参数分布及占比
   - 每个参数的具体精度信息

### 模型精度转换工具使用步骤
1. 添加 "模型精度转换与修复" 节点
2. 通过文件选择按钮设置：
   - `model_path`：需要转换的源模型路径
   - `save_directory`：转换后模型的保存目录
3. 选择参数：
   - `input_precision`：源模型的精度类型
   - `target_precision`：目标精度类型（支持 fp8、fp16、fp32、int4、int8 等）
   - `quantization_scheme`：量化方案（动态量化推荐用于大多数场景）
4. 可选：启用 `repair_model` 进行模型修复
5. 运行节点完成转换，转换后的模型将保存到指定目录

## 支持的精度类型
- 输入精度：bf16、fp16、fp32、int4、int8
- 目标精度：fp8（e4m3格式）、fp16、fp32、int4、int8

## 注意事项
1. 模型加载和转换可能需要较多内存，请确保系统资源充足
2. fp8 转换功能需要 PyTorch 2.0+ 版本支持，推荐使用 CUDA 11.8+ 环境获得最佳性能
3. 量化操作（int4/int8）可能导致模型精度损失，建议转换后进行测试
4. 大模型转换时间可能较长，请耐心等待
5. 若模型加载失败，请检查：
   - 文件路径是否正确
   - 模型文件是否损坏
   - 是否有足够的权限访问该文件

## 常见问题
- Q：文件选择按钮不显示？
  A：请确保 ComfyUI 版本在 v0.1.1 以上，旧版本可能不支持该功能

- Q：转换后的模型无法加载？
  A：尝试启用 `repair_model` 选项重新转换，或检查目标精度是否被支持
